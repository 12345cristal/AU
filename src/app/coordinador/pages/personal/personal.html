<div class="personal-wrapper">

  <!-- ================================================= -->
  <!-- üîπ HEADER SUPERIOR -->
  <!-- ================================================= -->
  <header class="header">
    <h2 class="title">Equipo Profesional</h2>

    <div class="actions">
      <!-- üîç Buscador -->
      <div class="search-box">
        <input
          type="text"
          placeholder="Buscar personal por nombre, correo o rol‚Ä¶"
          (input)="updateSearch($event)"
        />
        <span class="icon">üîç</span>
      </div>

      <!-- Vista -->
      <div class="view-switch">
        <button
          [class.active]="viewMode() === 'tarjeta'"
          (click)="switchView('tarjeta')"
        >
          üóÇÔ∏è
        </button>

        <button
          [class.active]="viewMode() === 'tabla'"
          (click)="switchView('tabla')"
        >
          üìã
        </button>
      </div>

      <button class="btn-primary" (click)="toggleSheet(true)">
        + Nuevo Profesional
      </button>
    </div>
  </header>

  <!-- ================================================= -->
  <!-- üîπ CONTENIDO PRINCIPAL -->
  <!-- ================================================= -->
  <section class="content">

    @switch (viewMode()) {

      <!-- ================================================= -->
      <!-- üü© VISTA TIPO DOCTORALIA - TARJETAS -->
      <!-- ================================================= -->
      @case ('tarjeta') {
        <div class="cards-grid">

          @for (p of filtered(); track p.id_personal) {

            <div class="pro-card">

              <!-- Foto / avatar -->
              <div class="photo">
                @if (p.foto) {
                  <img [src]="p.foto" alt="Foto de {{ p.nombre }}">
                } @else {
                  <div class="avatar">{{ p.iniciales }}</div>
                }
              </div>

              <!-- Informaci√≥n -->
              <div class="info">
                <h3 class="name">{{ p.nombre }}</h3>
                <p class="role">{{ p.rol }}</p>

                <div class="details">
                  <p>üìß {{ p.email }}</p>
                  <p>üìû {{ p.telefono }}</p>
                </div>

                <div class="rating">
                  ‚≠ê {{ p.calificacion }} <span>Calificaci√≥n</span>
                </div>
              </div>

              <!-- Botones -->
              <div class="more">
                <button class="btn-outline small">Ver perfil</button>
                <button class="btn-outline small danger">Eliminar</button>
              </div>

            </div>

          }

          @if (!filtered().length) {
            <div class="empty">No se encontr√≥ personal</div>
          }

        </div>
      }

      <!-- ================================================= -->
      <!-- üü¶ VISTA TABLA -->
      <!-- ================================================= -->
      @case ('tabla') {
        <div class="table-container">

          <table class="premium-table">
            <thead>
              <tr>
                <th>Foto</th>
                <th>Nombre</th>
                <th>Rol</th>
                <th>Email</th>
                <th>Tel√©fono</th>
                <th>Calificaci√≥n</th>
                <th>Acciones</th>
              </tr>
            </thead>

            <tbody>
              @for (p of filtered(); track p.id_personal) {
                <tr>
                  <td>
                    @if (p.foto) {
                      <img [src]="p.foto" class="mini-photo">
                    } @else {
                      <div class="mini-avatar">{{ p.iniciales }}</div>
                    }
                  </td>

                  <td>{{ p.nombre }}</td>
                  <td>{{ p.rol }}</td>
                  <td>{{ p.email }}</td>
                  <td>{{ p.telefono }}</td>
                  <td>{{ p.calificacion }}</td>

                  <td>
                    <button class="btn-mini">Editar</button>
                    <button class="btn-mini danger">Eliminar</button>
                  </td>
                </tr>
              }
            </tbody>
          </table>

          @if (!filtered().length) {
            <div class="empty">No hay resultados</div>
          }

        </div>
      }
    }

  </section>

  <!-- ================================================= -->
  <!-- üü™ MODAL PREMIUM -->
  <!-- ================================================= -->
  <div class="modal-backdrop" [class.open]="sheetOpen()" (click)="toggleSheet(false)"></div>

  <div class="modal" [class.open]="sheetOpen()" (click)="$event.stopPropagation()">

    <div class="modal-header">
      <h3>Registrar nuevo profesional</h3>
      <button class="close-btn" (click)="toggleSheet(false)">‚úï</button>
    </div>

    <form [formGroup]="personalForm" (ngSubmit)="guardarPersonal()" class="modal-body">

      <!-- =======================
      DATOS PERSONALES
      ======================= -->
      <h4 class="section">Datos del Usuario</h4>

      <div class="grid">
        <input formControlName="nombre" placeholder="Nombre completo *" />
        <input formControlName="apellido_paterno" placeholder="Apellido paterno" />
        <input formControlName="apellido_materno" placeholder="Apellido materno" />
        <input formControlName="correo" placeholder="Correo *" type="email" />
        <input formControlName="telefono" placeholder="Tel√©fono" />

        <select formControlName="id_rol">
          <option value="">Seleccionar rol‚Ä¶</option>
          @for (r of roles(); track r.id_rol) {
            <option [value]="r.id_rol">{{ r.nombre_rol }}</option>
          }
        </select>

        <input type="password" placeholder="Contrase√±a *" formControlName="contrasena" />

        <label class="file">
          Foto de perfil
          <input type="file" accept="image/*" (change)="onFileChange($event, 'foto')">
        </label>
      </div>

      <!-- =======================
      DATOS PROFESIONALES
      ======================= -->
      <h4 class="section">Datos Profesionales</h4>

      <div class="grid">
        <input type="date" formControlName="fecha_nacimiento" />

        <!-- üìå SELECT premium -->
        <select formControlName="grado_academico">
          <option value="">Grado acad√©mico‚Ä¶</option>
          <option>Secundaria</option>
          <option>Preparatoria</option>
          <option>Licenciatura</option>
          <option>Maestr√≠a</option>
          <option>Doctorado</option>
        </select>

        <input placeholder="Especialidades" formControlName="especialidades" />
        <input placeholder="Tel√©fono personal" formControlName="telefono_personal" />
        <input placeholder="Correo alterno" formControlName="correo_personal" />

        <input placeholder="RFC" formControlName="rfc" />
        <input placeholder="INE" formControlName="ine" />
        <input placeholder="CURP" formControlName="curp" />

        <input placeholder="Calle" formControlName="domicilio_calle" />
        <input placeholder="Colonia" formControlName="domicilio_colonia" />
        <input placeholder="C√≥digo Postal" formControlName="domicilio_cp" />
        <input placeholder="Municipio" formControlName="domicilio_municipio" />
        <input placeholder="Estado" formControlName="domicilio_estado" />

        <label class="file">
          Subir CV
          <input type="file" accept=".pdf,.doc,.docx" (change)="onFileChange($event, 'cv')">
        </label>

        <textarea formControlName="experiencia" placeholder="Experiencia profesional" rows="4"></textarea>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn ghost" (click)="toggleSheet(false)">
          Cancelar
        </button>

        <button type="submit" class="btn primary" [disabled]="personalForm.invalid">
          Guardar
        </button>
      </div>

    </form>
  </div>

</div>
